# MSA Ecommerce
- [MSA Ecommerce] Docker 환경 설정

## 프로젝트 환경 Docker Container 실행
- **[Network]**
	- docker network create --gateway 172.18.0.1 --subnet 172.18.0.0/16 ecommerce-network
------------
- **[RabbitMQ]**
	- docker run -d --network ecommerce-network -p 15672:15672 -p 5672:5672 -p 15671:15671 -p 5671:5671 -p 4369:4369 -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest --name rabbitmq rabbitmq:management
------------
- MariaDB **[미사용]**
	- **[Dockerfile_mariadb 다운로드 필요 <= 다운로드 경로에서 작업 필요]**
		- [docker-files/mariadb/Dockerfile_mariadb](https://github.com/heom/MSA-Ecommerce/blob/master/docker-files/mariadb/Dockerfile_mariadb)
	- docker build -t ccs159/my-mariadb:1.0 -f Dockerfile_mariadb .
	- docker run -d --network ecommerce-network -p 3307:3306 --name mariadb ccs159/my-mariadb:1.0
------------
 - **[Kafka(+Zookeper)]**
	- **[Git hub clone url](https://github.com/wurstmeister/kafka-docker)**
	- **[kafka 다운로드 필요 <= 다운로드 경로에서 작업 필요]**
		- [docker-files/kafka](https://github.com/heom/MSA-Ecommerce/tree/master/docker-files/kafka)
	- **[중요]docker-compose-single-broker.yml**	
	- docker-compose -f docker-compose-single-broker-docker.yml up -d
------------
- **[Zipkin]**
	- docker run -d --network ecommerce-network -p 9411:9411 --name zipkin openzipkin/zipkin 
------------
- **[Prometheus]**
	- **[설정파일 다운로드 필요]**
		- [docker-files/prometheus/prometheus.yml](https://github.com/heom/MSA-Ecommerce/tree/master/docker-files/prometheus/prometheus.yml)
	- docker run -d --network ecommerce-network -p 9090:9090 -v ${다운로드 경로}/prometheus.yml:/etc/prometheus/prometheus-docker.yml --name prometheus prom/prometheus 
------------
- **[Grafana]**
	- docker run -d --network ecommerce-network -p 3000:3000 --name grafana grafana/grafana 


## 프로젝트 소스 Docker Container 실행
- **[ConfigServer]**
	- **[프로젝트 Root에 Dockerfile 존재 <= 프로젝트 Root에서 작업 필요]**
	- docker build -t ccs159/config-service:1.0 .
	- docker push ccs159/config-service:1.0
	- docker run -d -p 8888:8888 --network ecommerce-network -e "spring.rabbitmq.host=rabbitmq" -e "spring.profiles.active=default" --name config-service ccs159/config-service:1.0
------------
- **[DiscoveryService]**
	- **[프로젝트 Root에 Dockerfile 존재 <= 프로젝트 Root에서 작업 필요]**
	- docker build -t ccs159/discovery-service:1.0 .
	- docker push ccs159/discovery-service:1.0
	- docker run -d -p 8761:8761 --network ecommerce-network -e "spring.cloud.config.uri=http://config-service:8888" -e "spring.rabbitmq.host=rabbitmq" --name discovery-service ccs159/discovery-service:1.0
------------
- **[APIGatewayServer]**
	- **[프로젝트 Root에 Dockerfile 존재 <= 프로젝트 Root에서 작업 필요]**
	- docker build -t ccs159/apigateway-service:1.0 .
	- docker push ccs159/apigateway-service:1.0
	- docker run -d -p 8000:8000 --network ecommerce-network -e "spring.cloud.config.uri=http://config-service:8888" -e "spring.rabbitmq.host=rabbitmq" -e "eureka.client.serviceUrl.defaultZone=http://discovery-service:8761/eureka/" --name apigateway-service ccs159/apigateway-service:1.0
------------
- **[UserService]**
	- **[프로젝트 Root에 Dockerfile 존재 <= 프로젝트 Root에서 작업 필요]**
	- docker build -t ccs159/user-service:1.0 .
	- docker push ccs159/user-service:1.0
	- docker run -d --network ecommerce-network -e "spring.cloud.config.uri=http://config-service:8888" -e "spring.rabbitmq.host=rabbitmq" -e "spring.zipkin.base-url=http://zipkin:9411" -e "eureka.client.serviceUrl.defaultZone=http://discovery-service:8761/eureka/" -e "logging.file=/api-logs/users-ws.log" --name user-service ccs159/user-service:1.0
------------
- **[OrderService]**
	- **[프로젝트 Root에 Dockerfile 존재 <= 프로젝트 Root에서 작업 필요]**
	- docker build -t ccs159/order-service:1.0 .
	- docker push ccs159/order-service:1.0
	- docker run -d --network ecommerce-network -e "spring.cloud.config.uri=http://config-service:8888" -e "spring.rabbitmq.host=rabbitmq" -e "spring.zipkin.base-url=http://zipkin:9411" -e "eureka.client.serviceUrl.defaultZone=http://discovery-service:8761/eureka/" -e "my-kafka.servers=172.18.0.101:9092" -e "logging.file=/api-logs/orders-ws.log" --name order-service ccs159/order-service:1.0
------------
- **[CatalogService]**
	- **[프로젝트 Root에 Dockerfile 존재 <= 프로젝트 Root에서 작업 필요]**
	- docker build -t ccs159/catalog-service:1.0 .
	- docker push ccs159/catalog-service:1.0
	- docker run -d --network ecommerce-network -e "spring.cloud.config.uri=http://config-service:8888" -e "spring.rabbitmq.host=rabbitmq" -e "eureka.client.serviceUrl.defaultZone=http://discovery-service:8761/eureka/" -e "my-kafka.servers=172.18.0.101:9092" -e "logging.file=/api-logs/catalogs-ws.log" --name catalog-service ccs159/catalog-service:1.0
